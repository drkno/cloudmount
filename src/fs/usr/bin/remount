#!/bin/bash
. "/usr/bin/config"

if [ -z "$(ls -A ${RCLONE_MOUNT})" ] || [ $(ps -ef | grep "unionfs" | grep -v "grep" | wc -l) == "0" ]; then
    echo "[ $(date $(printenv DATE_FORMAT)) ] Mount has dropped. Remount in progress."
    echo "[ $(date $(printenv DATE_FORMAT)) ] Unmounting..."
    fusermount -uz "${PLEXDRIVE_MOUNT}"
    fusermount -uz "${RCLONE_MOUNT}"
    fusermount -uz "${PLEXDRIVE_DECRYPT_MOUNT}"
    fusermount -uz "${MOUNT_DIR}"
    
    echo "[ $(date $(printenv DATE_FORMAT)) ] Unmounted successfully"
    echo "[ $(date $(printenv DATE_FORMAT)) ] Mounting..."
    mount
    echo "[ $(date $(printenv DATE_FORMAT)) ] Mounted successfully"
fi
