#!/bin/bash

CONFIG_DIR='/config'

LOG_DIR="${CONFIG_DIR}/log"
DB_DIR="${CONFIG_DIR}/db"
MOUNT_DIR="${CONFIG_DIR}/local-media"
INTERMEDIATE_DIR="${CONFIG_DIR}/intermediate_mounts"

PLEXDRIVE_MOUNT="${INTERMEDIATE_DIR}/plexdrive"
RCLONE_MOUNT="${INTERMEDIATE_DIR}/rclone"
UPLOAD_QUEUE="${INTERMEDIATE_DIR}/upload_queue"

rclone_config="--config=${CONFIG_DIR}/rclone.conf"
rclone_options="${rclone_config} --buffer-size ${BUFFER_SIZE} --checkers ${CHECKERS}"
rclone_mount_options="${rclone_options} --allow-non-empty --allow-other --max-read-ahead ${MAX_READ_AHEAD} --uid ${PUID} --gid ${PGID} --read-only"

plexdrive_options="--config=${CONFIG_DIR} --cache-file=${DB_DIR}/cache.bolt --chunk-size=${CHUNK_SIZE} --chunk-check-threads=${CHUNK_CHECK_THREADS} --chunk-load-ahead=${CHUNK_LOAD_AHEAD} --chunk-load-threads=${CHUNK_LOAD_THREADS} --uid=${PUID} --gid=${PGID} -o allow_other  -o read_only"
if [ ! -z $(printenv MAX_NUM_CHUNKS) ]; then
    plexdrive_options="${plexdrive_options} --max-chunks=${MAX_NUM_CHUNKS}"
fi
if [ ! -z "DRIVE_ID" ]; then
    plexdrive_options="${plexdrive_options} --drive-id=${DRIVE_ID}"
fi
